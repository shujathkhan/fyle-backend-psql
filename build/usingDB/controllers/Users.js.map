{"version":3,"sources":["../../../src/usingDB/controllers/Users.js"],"names":["User","create","req","res","body","email","password","status","send","Helper","isValidEmail","hashPassword","createQuery","values","Date","db","query","rows","token","generateToken","id","console","log","routine","login","text","comparePassword","deleteQuery","user"],"mappings":";;;;;;;AACA;;AACA;;AACA;;AACA;;;;;;;;AAGA,IAAMA,IAAI,GAAG;AACT;;;;;;AAMMC,EAAAA,MAPG;AAAA;AAAA;AAAA,6CAOIC,GAPJ,EAOSC,GAPT;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,oBAQH,CAACD,GAAG,CAACE,IAAJ,CAASC,KAAV,IAAmB,CAACH,GAAG,CAACE,IAAJ,CAASE,QAR1B;AAAA;AAAA;AAAA;;AAAA,+CASEH,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAC,2BAAW;AAAZ,eAArB,CATF;;AAAA;AAAA,kBAWFC,mBAAOC,YAAP,CAAoBR,GAAG,CAACE,IAAJ,CAASC,KAA7B,CAXE;AAAA;AAAA;AAAA;;AAAA,+CAYEF,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAE,2BAAW;AAAb,eAArB,CAZF;;AAAA;AAcDG,cAAAA,YAdC,GAccF,mBAAOE,YAAP,CAAoBT,GAAG,CAACE,IAAJ,CAASE,QAA7B,CAdd;AAgBDM,cAAAA,WAhBC;AAoBDC,cAAAA,MApBC,GAoBQ,CACb,oBADa,EAEbX,GAAG,CAACE,IAAJ,CAASC,KAFI,EAGbM,YAHa,EAIb,wBAAO,IAAIG,IAAJ,EAAP,CAJa,EAKb,wBAAO,IAAIA,IAAJ,EAAP,CALa,CApBR;AAAA;AAAA;AAAA,qBA6BkBC,eAAGC,KAAH,CAASJ,WAAT,EAAsBC,MAAtB,CA7BlB;;AAAA;AAAA;AA6BGI,cAAAA,IA7BH,QA6BGA,IA7BH;AA8BCC,cAAAA,KA9BD,GA8BST,mBAAOU,aAAP,CAAqBF,IAAI,CAAC,CAAD,CAAJ,CAAQG,EAA7B,CA9BT;AA+BLC,cAAAA,OAAO,CAACC,GAAR,CAAYJ,KAAZ;AA/BK,+CAgCEf,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEU,gBAAAA,KAAK,EAALA;AAAF,eAArB,CAhCF;;AAAA;AAAA;AAAA;;AAAA,oBAkCD,YAAMK,OAAN,KAAkB,kBAlCjB;AAAA;AAAA;AAAA;;AAAA,+CAqCMpB,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAE,2BAAW;AAAb,eAArB,CArCN;;AAAA;AAAA,+CAwCEL,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,aAxCF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AA2CT;;;;;;AAMMgB,EAAAA,KAjDG;AAAA;AAAA;AAAA,8CAiDGtB,GAjDH,EAiDQC,GAjDR;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,oBAkDH,CAACD,GAAG,CAACE,IAAJ,CAASC,KAAV,IAAmB,CAACH,GAAG,CAACE,IAAJ,CAASE,QAlD1B;AAAA;AAAA;AAAA;;AAAA,gDAmDEH,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAC,2BAAW;AAAZ,eAArB,CAnDF;;AAAA;AAAA,kBAqDFC,mBAAOC,YAAP,CAAoBR,GAAG,CAACE,IAAJ,CAASC,KAA7B,CArDE;AAAA;AAAA;AAAA;;AAAA,gDAsDEF,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAE,2BAAW;AAAb,eAArB,CAtDF;;AAAA;AAwDDiB,cAAAA,IAxDC,GAwDM,sCAxDN;AAAA;AAAA;AAAA,qBA0DkBV,eAAGC,KAAH,CAASS,IAAT,EAAe,CAACvB,GAAG,CAACE,IAAJ,CAASC,KAAV,CAAf,CA1DlB;;AAAA;AAAA;AA0DGY,cAAAA,IA1DH,SA0DGA,IA1DH;;AAAA,kBA2DAA,IAAI,CAAC,CAAD,CA3DJ;AAAA;AAAA;AAAA;;AAAA,gDA4DId,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAC,2BAAW;AAAZ,eAArB,CA5DJ;;AAAA;AAAA,kBA8DDC,mBAAOiB,eAAP,CAAuBT,IAAI,CAAC,CAAD,CAAJ,CAAQX,QAA/B,EAAyCJ,GAAG,CAACE,IAAJ,CAASE,QAAlD,CA9DC;AAAA;AAAA;AAAA;;AAAA,gDA+DIH,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAE,2BAAW;AAAb,eAArB,CA/DJ;;AAAA;AAiECU,cAAAA,KAjED,GAiEST,mBAAOU,aAAP,CAAqBF,IAAI,CAAC,CAAD,CAAJ,CAAQG,EAA7B,CAjET;AAkELC,cAAAA,OAAO,CAACC,GAAR,CAAYJ,KAAZ;AAlEK,gDAmEEf,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEU,gBAAAA,KAAK,EAALA;AAAF,eAArB,CAnEF;;AAAA;AAAA;AAAA;AAAA,gDAqEEf,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,cArEF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAwET;;;;;;AAxES;AAAA;AAAA;AAAA,8CA8EIN,GA9EJ,EA8ESC,GA9ET;AAAA;;AAAA;AAAA;AAAA;AAAA;AA+EDwB,cAAAA,WA/EC,GA+Ea,2CA/Eb;AAAA;AAAA;AAAA,qBAiFkBZ,eAAGC,KAAH,CAASW,WAAT,EAAsB,CAACzB,GAAG,CAAC0B,IAAJ,CAASR,EAAV,CAAtB,CAjFlB;;AAAA;AAAA;AAiFGH,cAAAA,IAjFH,SAiFGA,IAjFH;;AAAA,kBAkFDA,IAAI,CAAC,CAAD,CAlFH;AAAA;AAAA;AAAA;;AAAA,gDAmFId,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAC,2BAAW;AAAZ,eAArB,CAnFJ;;AAAA;AAAA,gDAqFEL,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAE,2BAAW;AAAb,eAArB,CArFF;;AAAA;AAAA;AAAA;AAAA,gDAuFEL,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,cAvFF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,CAAb;eA4FiBR,I","sourcesContent":["\nimport moment from 'moment';\nimport uuidv4 from 'uuid/v4';\nimport db from '../db';\nimport Helper from './Helper';\n\n\nconst User = {\n    /**\n     * Create A User\n     * @param {object} req \n     * @param {object} res\n     * @returns {object} reflection object \n     */\n    async create(req, res) {\n      if (!req.body.email || !req.body.password) {\n        return res.status(400).send({'message': 'Some values are missing'});\n      }\n      if (!Helper.isValidEmail(req.body.email)) {\n        return res.status(400).send({ 'message': 'Please enter a valid email address' });\n      }\n      const hashPassword = Helper.hashPassword(req.body.password);\n  \n      const createQuery = `INSERT INTO\n        users(id, email, password, created_date, modified_date)\n        VALUES($1, $2, $3, $4, $5)\n        returning *`;\n      const values = [\n        uuidv4(),\n        req.body.email,\n        hashPassword,\n        moment(new Date()),\n        moment(new Date())\n      ];\n  \n      try {\n        const { rows } = await db.query(createQuery, values);\n        const token = Helper.generateToken(rows[0].id);\n        console.log(token)\n        return res.status(201).send({ token });\n      } catch(error) {\n        if (error.routine === '_bt_check_unique') {\n            // console.log(token)\n\n            return res.status(400).send({ 'message': 'User with that EMAIL already exist' })\n\n        }\n        return res.status(400).send(error);\n      }\n    },\n    /**\n     * Login\n     * @param {object} req \n     * @param {object} res\n     * @returns {object} user object \n     */\n    async login(req, res) {\n      if (!req.body.email || !req.body.password) {\n        return res.status(400).send({'message': 'Some values are missing'});\n      }\n      if (!Helper.isValidEmail(req.body.email)) {\n        return res.status(400).send({ 'message': 'Please enter a valid email address' });\n      }\n      const text = 'SELECT * FROM users WHERE email = $1';\n      try {\n        const { rows } = await db.query(text, [req.body.email]);\n        if (!rows[0]) {\n          return res.status(400).send({'message': 'The credentials you provided is incorrect'});\n        }\n        if(!Helper.comparePassword(rows[0].password, req.body.password)) {\n          return res.status(400).send({ 'message': 'The credentials you provided is incorrect' });\n        }\n        const token = Helper.generateToken(rows[0].id);\n        console.log(token)\n        return res.status(200).send({ token });\n      } catch(error) {\n        return res.status(400).send(error)\n      }\n    },\n    /**\n     * Delete A User\n     * @param {object} req \n     * @param {object} res \n     * @returns {void} return status code 204 \n     */\n    async delete(req, res) {\n      const deleteQuery = 'DELETE FROM users WHERE id=$1 returning *';\n      try {\n        const { rows } = await db.query(deleteQuery, [req.user.id]);\n        if(!rows[0]) {\n          return res.status(404).send({'message': 'user not found'});\n        }\n        return res.status(204).send({ 'message': 'deleted' });\n      } catch(error) {\n        return res.status(400).send(error);\n      }\n    }\n  }\n  \n  export default User;\n  "],"file":"Users.js"}