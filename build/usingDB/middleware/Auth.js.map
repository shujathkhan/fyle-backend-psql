{"version":3,"sources":["../../../src/usingDB/middleware/Auth.js"],"names":["Auth","verifyToken","req","res","next","token","headers","status","send","jwt","verify","process","env","SECRET","decoded","text","db","query","userId","rows","user","id"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;;;AAEA,IAAMA,OAAO;AACX;;;;;;;AAOMC,aARK;AAAA,wFAQOC,GARP,EAQYC,GARZ,EAQiBC,IARjB;AAAA;;AAAA;AAAA;AAAA;AAAA;AASHC,mBATG,GASKH,IAAII,OAAJ,CAAY,gBAAZ,CATL;;AAAA,kBAULD,KAVK;AAAA;AAAA;AAAA;;AAAA,+CAWAF,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAE,WAAW,uBAAb,EAArB,CAXA;;AAAA;AAAA;AAAA;AAAA,qBAceC,uBAAIC,MAAJ,CAAWL,KAAX,EAAkBM,QAAQC,GAAR,CAAYC,MAA9B,CAdf;;AAAA;AAcDC,qBAdC;AAeDC,kBAfC,GAeM,mCAfN;AAAA;AAAA,qBAgBgBC,aAAGC,KAAH,CAASF,IAAT,EAAe,CAACD,QAAQI,MAAT,CAAf,CAhBhB;;AAAA;AAAA;AAgBCC,kBAhBD,SAgBCA,IAhBD;;AAAA,kBAiBHA,KAAK,CAAL,CAjBG;AAAA;AAAA;AAAA;;AAAA,+CAkBEhB,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAE,WAAW,mCAAb,EAArB,CAlBF;;AAAA;AAoBPN,kBAAIkB,IAAJ,GAAW,EAAEC,IAAIP,QAAQI,MAAd,EAAX;AACAd;AArBO;AAAA;;AAAA;AAAA;AAAA;AAAA,+CAuBAD,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,aAvBA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,CAAb;;kBA4BeR,I","file":"Auth.js","sourcesContent":["import jwt from 'jsonwebtoken';\nimport db from '../db';\n\nconst Auth = {\n  /**\n   * Verify Token\n   * @param {object} req \n   * @param {object} res \n   * @param {object} next\n   * @returns {object|void} response object \n   */\n  async verifyToken(req, res, next) {\n    const token = req.headers['x-access-token'];\n    if(!token) {\n      return res.status(400).send({ 'message': 'Token is not provided' });\n    }\n    try {\n      const decoded = await jwt.verify(token, process.env.SECRET);\n      const text = 'SELECT * FROM users WHERE id = $1';\n      const { rows } = await db.query(text, [decoded.userId]);\n      if(!rows[0]) {\n        return res.status(400).send({ 'message': 'The token you provided is invalid' });\n      }\n      req.user = { id: decoded.userId };\n      next();\n    } catch(error) {\n      return res.status(400).send(error);\n    }\n  }\n}\n\nexport default Auth;"]}